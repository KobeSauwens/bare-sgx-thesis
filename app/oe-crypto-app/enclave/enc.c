// Copyright (c) Open Enclave SDK contributors.
// Licensed under the MIT License.

#include <stdio.h>

// Include the trusted oe-crypto-app header that is generated
// during the build. This file is generated by calling the
// sdk tool oeedger8r against the oe-crypto-app.edl file.
#include "oe_crypto_app_t.h"
#include "dist/portable-gcc-compatible/Hacl_HMAC.h"

#define KEY_LEN 16  // 128 bits
#define TAG_LEN 32  // 256 bits

// This is the function that the host calls. It prints
// a message in the enclave before calling back out to
// the host to print a message from there too.
int oe_encl_op_hmac(uint8_t *digest, uint8_t *data, uint32_t data_len)
{
    uint8_t key[KEY_LEN] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
    };
    Hacl_HMAC_compute_sha2_256(digest, key, KEY_LEN, data, data_len);
    return 1;
}
